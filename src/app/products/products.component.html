@if(isLoading) {
<app-loading></app-loading>
} @else {
<section class="mt-4 max-w-screen-lg mx-auto px-3 sm:px-0">
  <!-- Barra de filtros -->
  <div class="w-full mt-8 bg-white rounded-md shadow-md p-4
           flex flex-col sm:flex-row gap-4 items-center justify-between
           sm:max-w-none mx-auto">
    <!-- Buscar -->
    <div class="w-full sm:w-1/2">
      <input type="text" placeholder="Buscar producto..." class="w-full border border-gray-300 rounded-md px-3 py-2
               focus:outline-none focus:ring-2 focus:ring-gray-400" (input)="onSearch($event)" />
    </div>

    <!-- Categoría -->
    <div class="w-full sm:w-1/3">
      <select class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white
               focus:outline-none focus:ring-2 focus:ring-gray-400" (change)="onCategoryChange($event)">
        <option value="">Todas las categorías</option>
        @for (category of categories; track category.id) {
        <option [value]="category.id">{{ category.title }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Grid productos -->
  <article class="mt-3 grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4
           gap-4 justify-center mb-3">
    @defer {
    @for (product of paginatedProducts; track product.productId) {
    <app-products-list [product]="product" />
    }
    }
    @placeholder (minimum 200ms) {
    <app-home-product-loading />
    <app-home-product-loading />
    <app-home-product-loading />
    <app-home-product-loading />
    }
  </article>
  <!-- Paginación -->
    <div class="bg-white flex flex-col sm:flex-row items-center justify-between gap-3 mb-10 px-3 rounded-lg">
    <p class="text-sm text-gray-600">
      Página <strong>{{ pageIndex }}</strong> de <strong>{{ totalPages }}</strong> ·
      Mostrando <strong>{{ paginatedProducts.length }}</strong> de <strong>{{ filteredProducts.length }}</strong>
    </p>

    <div class="flex items-center gap-2">
      <button class="px-3 py-2 rounded-md disabled:opacity-50" (click)="prevPage()"
        [disabled]="pageIndex === 1">
        <span
          class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gray-500 group-hover:bg-gray-400 group-focus:ring-4 group-focus:ring-gray-300 group-focus:outline-none">
          <svg width="6" height="10" class="w-4 h-4 text-white rtl:rotate-180" aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M5 1 1 5l4 4" />
          </svg>
          <span class="sr-only">Previous</span>
        </span>
      </button>

      <!-- Botones de páginas (1..totalPages) con recorte -->
      @for (p of [].constructor(totalPages); track $index) {
      <button class="px-3 py-2 rounded-md border" [class.bg-gray-900]="($index + 1) === pageIndex"
        [class.text-white]="($index + 1) === pageIndex" [class.bg-white]="($index + 1) !== pageIndex"
        (click)="goToPage($index + 1)">
        {{ $index + 1 }}
      </button>
      }

      <button class="px-3 py-2 rounded-md disabled:opacity-50" (click)="nextPage()"
        [disabled]="pageIndex === totalPages">
        <span
          class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gray-500 group-hover:bg-gray-400 group-focus:ring-4 group-focus:ring-gray-300 group-focus:outline-none">
          <svg width="6" height="10" class="w-4 h-4 text-white rtl:rotate-180" aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="m1 9 4-4-4-4" />
          </svg>
          <span class="sr-only">Next</span>
        </span>
      </button>
    </div>
  </div>
  
</section>
}